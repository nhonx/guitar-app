:root {
    --wood-dark: #2d1b15;
    --wood-light: #5d4037;
    --sidebar-bg: #1a1a1a;
    --active-color: #ff9800;
    --safe-left: env(safe-area-inset-left);
    --safe-right: env(safe-area-inset-right);
}

* {
    box-sizing: border-box;
    user-select: none;
    -webkit-user-select: none;
    touch-action: none;
    -webkit-tap-highlight-color: transparent;
}

body {
    margin: 0; 
    padding: 0; 
    background: #000;
    height: 100dvh; /* Dynamic viewport height */
    width: 100vw; 
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    display: flex; 
    flex-direction: column;
}

/* --- ORIENTATION LOCK --- */
@media screen and (orientation: portrait) {
    #rotate-message { display: flex !important; }
    #main-app { display: none !important; }
}

#rotate-message {
    display: none; 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #111; color: white; z-index: 9999;
    flex-direction: column; justify-content: center; align-items: center;
}

.rotate-icon {
    font-size: 3rem; 
    margin-bottom: 15px;
}

/* --- MAIN LAYOUT --- */
#main-app {
    display: flex; 
    flex-direction: row; 
    width: 100%; 
    height: 100%;
    padding-left: var(--safe-left); 
}

/* --- GUITAR BODY --- */
#guitar-body {
    flex: 1;
    background: radial-gradient(circle at 40% 50%, var(--wood-light) 0%, var(--wood-dark) 60%, #000 95%);
    position: relative;
    display: flex; 
    flex-direction: column;
    overflow: hidden;
}

#sound-hole {
    position: absolute; top: 50%; left: -20%;
    transform: translate(0, -50%);
    height: 90%; aspect-ratio: 1/1;
    background: #100805; border-radius: 50%;
    border: 6px solid #4e342e;
    box-shadow: inset 0 0 50px #000; z-index: 0;
}

#settings-trigger {
    position: absolute; top: 10px; left: 10px;
    width: 40px; height: 40px;
    background: rgba(0,0,0,0.6); border: 1px solid #555;
    border-radius: 50%; color: white; font-size: 1.2rem;
    display: flex; justify-content: center; align-items: center;
    z-index: 100; cursor: pointer; backdrop-filter: blur(4px);
}

/* --- STRINGS --- */
#strings-container {
    z-index: 10;
    display: flex; flex-direction: column;
    justify-content: space-between;
    padding: 10vh 0; 
    height: 100%; width: 100%;
}

.string { position: relative; width: 100%; height: 40px; display: flex; align-items: center; }
.string-line { width: 100%; box-shadow: 0 3px 6px rgba(0,0,0,0.8); transition: transform 0.05s; }

.s0 .string-line { height: 4.5px; background: #ffb74d; }
.s1 .string-line { height: 3.8px; background: #ffb74d; }
.s2 .string-line { height: 3.2px; background: #ffb74d; }
.s3 .string-line { height: 2.5px; background: #ffb74d; }
.s4 .string-line { height: 1.5px; background: #cfd8dc; }
.s5 .string-line { height: 1.0px; background: #cfd8dc; }

.vibrating .string-line { animation: vibrate 0.15s linear infinite; }
@keyframes vibrate { 0% { transform: translateY(0); } 50% { transform: translateY(2px); } 100% { transform: translateY(0); } }

/* --- OPTIMIZED CHORD BAR --- */
#chord-bar {
    /* Slightly wider to accommodate 2 columns if needed */
    width: 140px;/*clamp(90px, 18vw, 140px);*/
    min-width: 90px;
    height: 100%;
    
    background: var(--sidebar-bg);
    border-left: 2px solid #333;
    
    /* GRID LAYOUT FOR WRAPPING */
    display: grid;
    /* Auto-fill columns: buttons minimum 45px wide. 
       This creates 1 column on narrow screens, 2 on wider ones. */
    grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
    /* Rows adjust to content */
    grid-auto-rows: min-content;
    
    gap: 8px; 
    padding: 10px 5px;
    padding-right: calc(5px + var(--safe-right)); 
    
    /* Allow scrolling */
    overflow-y: auto; 
    overflow-x: hidden;
    z-index: 20;
    box-shadow: -5px 0 15px rgba(0,0,0,0.6);
    
    /* Alignment within the grid cells */
    align-content: start;
}

.chord-btn {
    /* Remove fixed width, fill the grid cell */
    width: 100%;
    /* Keep aspect ratio square */
    aspect-ratio: 1/1;
    
    border-radius: 50%;
    border: 2px solid #444;
    background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
    color: #ddd; 
    
    /* Font size scales */
    font-size: clamp(0.7rem, 2vh, 1rem);
    font-weight: bold;
    display: flex; justify-content: center; align-items: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.4);
    transition: all 0.1s;
    word-break: break-all; /* Prevent overflow for long names like C#m7 */
}

.chord-btn.active {
    background: var(--active-color); color: #2d1b15;
    border-color: var(--active-color); transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255, 152, 0, 0.4);
    z-index: 2; /* Pop above neighbors */
}

.chord-btn.add-btn {
    background: transparent; border: 1px dashed #555; color: #888;
    font-size: 1.5rem;
}

/* ... [Rest of CSS (Settings Modal, Capo, etc) remains the same] ... */

/* Update Library Grid in Modal for new Chords */
.lib-btn.sharp { color: #ffab91; border-color: #5d4037; }
.lib-btn.minor { font-size: 0.85rem; }

.chord-btn {
    /* AUTO-SCALING SIZE */
    width: clamp(40px, 13vh, 65px);
    height: clamp(40px, 13vh, 65px);
    
    border-radius: 50%;
    aspect-ratio: 1/1;
    flex-shrink: 0;

    border: 2px solid #444;
    background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
    color: #ddd; 
    
    /* Font size scales with button */
    font-size: clamp(0.7rem, 2.2vh, 1.1rem);
    font-weight: bold;
    display: flex; justify-content: center; align-items: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.4);
    transition: all 0.1s;
}

.chord-btn.active {
    background: var(--active-color); color: #2d1b15;
    border-color: var(--active-color); transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255, 152, 0, 0.4);
}

.chord-btn.add-btn {
    background: transparent; border: 1px dashed #555; color: #888;
    font-size: 1.5rem;
}

/* --- SETTINGS MODAL --- */
#settings-modal {
    display: none; 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.95); 
    z-index: 2000;
    
    flex-direction: column; 
    align-items: center;
    
    /* FIX: Re-enable vertical scrolling for this container */
    touch-action: pan-y; 
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    
    padding: 20px var(--safe-right) 20px var(--safe-left);
    overflow-y: auto; /* Allow the content to overflow */
}

#settings-modal * {
    touch-action: pan-y;
}

.modal-content { width: 100%; max-width: 500px; padding-bottom: 40px; max-height: 80dvh; overflow-y: scroll; }
.modal-header { display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
.modal-title { color: #fff; font-size: 1.2rem; font-weight: bold; }
.close-icon { font-size: 1.5rem; color: #888; cursor: pointer; }
.setting-label { color: var(--active-color); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 8px; margin-top: 15px; }

.sound-options { display: flex; gap: 8px; }
.sound-btn { flex: 1; padding: 10px; background: #222; border: 1px solid #444; color: #aaa; border-radius: 6px; font-size: 0.8rem; }
.sound-btn.selected { background: var(--active-color); color: #000; font-weight: bold; }

.chord-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(42px, 1fr)); gap: 6px; }
.lib-btn { aspect-ratio: 1/1; background: #222; border: 1px solid #444; color: #fff; border-radius: 5px; font-size: 0.8rem; }
.lib-btn.added { border-color: var(--active-color); color: var(--active-color); background: #331f00; }

/* --- START OVERLAY --- */
#start-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.92); color: white;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    z-index: 1000; backdrop-filter: blur(8px);
}

.app-title { margin-bottom: 5px; color: var(--active-color); }
.subtitle { color:#aaa; font-size: 0.9rem; margin-bottom: 25px; }
.overlay-options { width: 250px; margin-bottom: 25px; }

#start-btn {
    padding: 12px 50px; 
    background: var(--active-color); 
    border: none; 
    border-radius: 30px; 
    font-weight: bold; 
    color: #000;
}
/* Capo Controls Styling */
.capo-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    background: #222;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #444;
}

.capo-btn {
    width: 40px;
    height: 40px;
    background: #333;
    border: 1px solid #555;
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
}

.capo-btn:active {
    background: var(--active-color);
    color: black;
}

#capo-display {
    color: var(--active-color);
    font-size: 1.5rem;
    font-weight: bold;
    min-width: 30px;
    text-align: center;
}